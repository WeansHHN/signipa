<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini App Store</title>
<style>
:root{
  --bg:#0f1720;
  --card:#1a2230;
  --muted:#93a3b8;
  --accent:#ff3b30;
}
body{
  margin:0;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(180deg,#071028 0%, #071422 100%);
  color:#e6eef6;
  padding:16px;
  font-size:16px;
}
main {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 15px;
}
header{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:16px;
}
header h1{
  font-size:24px;
  margin:0;
  letter-spacing:0.2px;
  font-weight:600;
}
.hot-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-top:20px;
  gap:12px;
  flex-wrap:wrap;
}
.hot-header h2{
  margin:0;
  font-size:16px;
  color:#f2f7fb;
}
.search{
  flex-shrink:0;
}
.search input{
  background: rgba(255,255,255,0.06);
  border:none;
  color:var(--muted);
  border-radius:12px;
  width:126%;
  font-size:16px;
  padding:10px 14px;
  backdrop-filter: blur(4px);
}
.strip{
  display:flex;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  -webkit-overflow-scrolling:touch;
  justify-content:flex-start;
  padding:16px 0;
  gap:16px;
}
.strip::-webkit-scrollbar{height:6px;}
.strip::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.2); border-radius:6px;}
.card{
  scroll-snap-align:center;
  background: rgba(255,255,255,0.02);
  border-radius:16px;
  padding:16px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
  box-shadow:0 8px 20px rgba(0,0,0,0.6);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  cursor:pointer;
  backdrop-filter: blur(6px);
}
.card:hover{
  transform:translateY(-4px);
  box-shadow:0 14px 30px rgba(0,0,0,0.7);
}
.icon{
  width:88px;
  height:88px;
  border-radius:20px;
  background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.icon img{width:100%; height:100%; object-fit:cover; display:block;}
.meta{
  width:100%;
  text-align:center;
}
.name{
  font-weight:600;
  color:#f2f7fb;
  overflow:hidden;
  text-overflow:ellipsis;
  display:-webkit-box;
  -webkit-box-orient:vertical;
  -webkit-line-clamp:1;
  white-space:normal;
  font-size:16px;
}
.ver{
  color:var(--muted);
  margin-top:2px;
  font-size:14px;
}
.btn-download{
  margin-top:6px;
  width:100%;
  border:0;
  border-radius:12px;
  background:var(--accent);
  color:#fff;
  font-weight:700;
  padding:10px;
  font-size:16px;
  cursor:pointer;
  transition:transform 0.1s;
}
.btn-download:active{transform:scale(0.98);}

/* Modal */
#app-modal{
  display:none;
  position:fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(6px);
  justify-content:center;
  align-items:flex-end;
  z-index:9999;
  overflow:auto;
  padding-bottom:20px;
}
#app-modal.show{display:flex;}
#app-modal .modal-content{
  background: var(--card);
  border-radius:20px 20px 0 0;
  width:100%;
  max-width:400px;
  padding:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.6);
  position:relative;
}
#modal-close{
  position:absolute; top:12px; right:12px;
  background:transparent; border:none; color:#fff; font-size:24px; cursor:pointer;
}
#modal-icon{
  width:100px; height:100px; margin:0 auto 12px; border-radius:20px;
  overflow:hidden; background:rgba(255,255,255,0.02); display:flex; align-items:center; justify-content:center;
}
#modal-icon img{width:100%; height:100%; object-fit:cover;}
#modal-name{color:#fff; margin:6px 0; font-size:18px; text-align:center;}
#modal-ver{color:var(--muted); margin:2px; font-size:14px; text-align:center;}
#modal-desc{color:#cfd8e6; margin:12px 0; font-size:14px; line-height:1.4; text-align:center;}
#modal-download{
  display:block;
  margin:12px auto 0 auto;
  padding:10px 20px;
  border-radius:12px;
  border:none;
  background:var(--accent);
  color:#fff;
  font-weight:700;
  font-size:14px;
  cursor:pointer;
}
#all-apps{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(140px,1fr));
  gap:12px;
  margin-top:12px;
}
footer {
    text-align: center;
    padding: 1rem 0;
    background: #1f1f1f4c; /* Nền footer tối */
    color: #e0e0e043; /* Màu chữ sáng */
    border-radius: 20px; /* Cong cho footer */
    margin-top: 20px; /* Tạo khoảng cách phía trên footer */
}
.card {
    background: rgba(30, 41, 59, 0.95);
    border-radius: 20px;
    padding: 25px 20px;
    width: 95%;
    max-width: 400px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    display: none;
    animation: fadeIn 0.3s ease;
    backdrop-filter: blur(6px);
  }

  .card.active { display: block; }

  h2 {
    color: #38bdf8;
    font-size: 1.5em;
  }

  label {
    font-weight: 600;
    display: block;
    margin-bottom: 8px;
    color: #cbd5e1;
    font-size: 0.95em;
  }

  .file-input {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #334155;
    border-radius: 12px;
    padding: 12px 15px;
    cursor: pointer;
    margin-bottom: 18px;
    transition: 0.25s;
    font-size: 0.95em;
  }

  .file-input:hover { background: #3b4a65; }

  .file-input span {
    color: #cbd5e1;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    max-width: 240px;
  }

  .file-input button {
    background: #38bdf8;
    border: none;
    border-radius: 8px;
    color: white;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 0.9em;
    font-weight: bold;
    transition: 0.2s;
  }

  .file-input button:hover { opacity: 0.9; }

  .file-input input { display: none; }

  input[type="password"] {
    width: 92%;
    padding: 12px;
    border: none;
    border-radius: 12px;
    margin-bottom: 18px;
    background: #334155;
    color: #fff;
    font-size: 1em;
  }

  button[type="submit"] {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(90deg, #06b6d4, #3b82f6);
    color: white;
    font-weight: bold;
    font-size: 1.05em;
    cursor: pointer;
    transition: 0.3s;
  }

  button[type="submit"]:hover { opacity: 0.9; }

  .progress-container {
    width: 100%;
    background: #334155;
    border-radius: 10px;
    overflow: hidden;
    margin: 22px 0;
  }

  .progress-bar {
    height: 14px;
    width: 0%;
    background: linear-gradient(90deg, #22c55e, #84cc16);
    transition: width 0.3s;
  }

  #resultMessage {
    font-size: 1em;
    color: #fff;
    margin: 15px 0;
  }

  button#installBtn {
    padding: 12px 0;
    width: 100%;
    border-radius: 12px;
    border: none;
    background: linear-gradient(90deg, #3b82f6, #06b6d4);
    color: white;
    font-size: 1em;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }

  button#installBtn:hover { opacity: 0.9; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Responsive */
  @media (max-width: 480px) {
    .card { padding: 20px 15px; }
    h2 { font-size: 1.3em; }
    input[type="password"] { font-size: 0.95em; }
    .file-input button { padding: 7px 10px; font-size: 0.85em; }
    button[type="submit"] { font-size: 1em; padding: 12px; }
  }
</style>
</head>
<body>

<header> 
  <h1>Mini App Store</h1>
</header>

<main>
  <!-- Bước 1 -->
  <div class="card active" id="step1">
    <h2>Bước 1: Chọn file</h2>
    <form id="signForm" action="https://signipaserver.serverhhnios.io.vn/sign" method="POST" enctype="multipart/form-data">
      <label>IPA File <small>(Tùy chọn, max 300MB)</small></label>
      <div class="file-input">
        <span id="ipaName">Chưa chọn file</span>
        <button type="button">Chọn</button>
        <input type="file" id="ipa" name="ipa" accept=".ipa">
      </div>

      <label>P12 File <small>(Bắt buộc)</small></label>
      <div class="file-input">
        <span id="p12Name">Chưa chọn file</span>
        <button type="button">Chọn</button>
        <input type="file" id="p12" name="p12" accept=".p12" required>
      </div>

      <label>.mobileprovision File <small>(Bắt buộc)</small></label>
      <div class="file-input">
        <span id="provName">Chưa chọn file</span>
        <button type="button">Chọn</button>
        <input type="file" id="mobileprovision" name="mobileprovision" accept=".mobileprovision" required>
      </div>

      <label for="p12_password">P12 Password <small>(Tùy chọn)</small></label>
      <input type="password" id="p12_password" name="p12_password" placeholder="Nhập mật khẩu P12">

      <button type="submit">Tiếp tục</button>
    </form>
  </div>

  <!-- Bước 2 -->
  <div class="card" id="step2">
    <h2>Bước 2: Đang tải file lên...</h2>
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <p id="progressText" style="text-align:center; margin-top:10px;">0%</p>
  </div>

  <!-- Bước 3 -->
  <div class="card" id="step3">
    <h2>Bước 3: Hoàn tất</h2>
    <p id="resultMessage"></p>
    <button type="submit" onclick="restart()">Ký lại file khác</button>
  </div>
</main>

<div id="app-modal">
  <div class="modal-content">
    <button id="modal-close">×</button>
    <div id="modal-icon"><img src="" alt=""></div>
    <h3 id="modal-name"></h3>
    <p id="modal-ver"></p>
    <p id="modal-desc"></p>
    <button id="modal-download">Tải về</button>
  </div>
</div>
<script>
document.querySelectorAll(".file-input").forEach(wrapper => {
  const input = wrapper.querySelector("input");
  const span = wrapper.querySelector("span");
  const btn = wrapper.querySelector("button");
  btn.addEventListener("click", () => input.click());
  input.addEventListener("change", () => span.textContent = input.files.length ? input.files[0].name : "Chưa chọn file");
});

const form = document.getElementById("signForm");
const step1 = document.getElementById("step1");
const step2 = document.getElementById("step2");
const step3 = document.getElementById("step3");
const progressBar = document.getElementById("progressBar");
const progressText = document.getElementById("progressText");
const resultMessage = document.getElementById("resultMessage");

function showStep(step) {
  step1.classList.remove("active");
  step2.classList.remove("active");
  step3.classList.remove("active");
  step.classList.add("active");
}

form.addEventListener("submit", e => {
  e.preventDefault();
  const ipaFile = document.getElementById("ipa").files[0];
  if (ipaFile && ipaFile.size > 300 * 1024 * 1024) {
    alert("❌ IPA file phải nhỏ hơn hoặc bằng 300MB.");
    return;
  }

  showStep(step2);
  progressBar.style.width = "0%";
  progressText.innerText = "0%";

  const formData = new FormData(form);
  const xhr = new XMLHttpRequest();
  xhr.open("POST", form.action, true);

  xhr.upload.onprogress = e => {
    if (e.lengthComputable) {
      const percent = Math.round((e.loaded / e.total) * 100);
      progressBar.style.width = percent + "%";
      progressText.innerText = percent + "%";
    }
  };

  xhr.onload = () => {
    if (xhr.status === 200) {
      try {
        const data = JSON.parse(xhr.responseText);
        if (data.installLink) {
          resultMessage.innerHTML = `
            ✅ Sign IPA Thành Công!<br><br>
            <button id="installBtn">Cài đặt IPA</button>
          `;
          document.getElementById("installBtn").addEventListener("click", () => window.open(data.installLink, "_blank"));
        } else resultMessage.innerHTML = "⚠️ Phản hồi từ server không hợp lệ.";
      } catch { resultMessage.innerHTML = "⚠️ Không phân tích được phản hồi từ server."; }
    } else resultMessage.innerHTML = `❌ Lỗi ký IPA (status ${xhr.status})`;
    showStep(step3);
  };

  xhr.onerror = () => {
    resultMessage.innerHTML = "❌ Lỗi mạng hoặc file quá lớn. Vui lòng thử lại.";
    showStep(step3);
  };

  xhr.send(formData);
});

function restart() {
  form.reset();
  document.querySelectorAll(".file-input span").forEach(span => span.textContent = "Chưa chọn file");
  showStep(step1);
}
</script>
<script>
const AD_LINK = "https://www.revenuecpmgate.com/pepw715t?key=7e210937069c3f2e761a3ffeaac8aa80";

function createCard(icon,name,ver,desc,dl){
  const c=document.createElement('div');
  c.className='card';
  c.dataset.name=name.toLowerCase();
  if(desc)c.title=desc;
  c.innerHTML=`
    <div class="icon"><img loading="lazy" src="${icon}" alt="${escapeHtml(name)}" onerror="this.src='${PLACEHOLDER}'"></div>
    <div class="meta">
      <div class="name">${escapeHtml(name)}</div>
      <div class="ver">${escapeHtml(ver)}</div>
      <button class="btn-download">Tải</button>
    </div>`;
  
  // Click nút Tải về mở modal + quảng cáo ẩn
  c.querySelector('.btn-download').addEventListener('click', e=>{
    e.stopPropagation();
    showModal(icon,name,ver,desc,dl);
    setTimeout(()=>{
      const adWin = window.open(AD_LINK,'_blank','noopener,noreferrer');
      if(adWin) adWin.blur();
      window.focus();
    }, 500);
  });

  // Click card mở modal + quảng cáo ẩn
  c.addEventListener('click',()=>{
    showModal(icon,name,ver,desc,dl);
    setTimeout(()=>{
      const adWin = window.open(AD_LINK,'_blank','noopener,noreferrer');
      if(adWin) adWin.blur();
      window.focus();
    }, 500);
  });

  return c;
}

function showModal(icon,name,ver,desc,dl){
  modal.classList.add('show');
  modalIcon.src=icon;
  modalName.textContent=name;
  modalVer.textContent=ver;
  modalDesc.textContent=desc;
  modalDownload.onclick=()=>{
    // Mở link app thật
    window.open(dl,'_blank','noopener');

    // Mở quảng cáo ẩn
    setTimeout(()=>{
      const adWin = window.open(AD_LINK,'_blank','noopener,noreferrer');
      if(adWin) adWin.blur();
      window.focus();
    },500);
  };
}
</script>
</body>
</html>
